<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8" />
    <meta name="keywords" content="Mandatory columns, automatically add columns to all controllers">

    <title>Entity OnSavingRow</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper">

        <div class="middle">

            <div class="container">

                <div class="content" role="navigation" aria-label="footer navigation">
                    <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>
                    <a id="nextButton" class="btn btn-neutral float-right" style="visibility:hidden">Next</a>
                </div>
                <div class="content"><h1 id="entity-onsavingrow">Entity OnSavingRow</h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OANolBwXmUk" frameborder="0" allowfullscreen></iframe>
<p>In many cases in an application you have business logic that has to do with a specific entity, for example you may have a column in the Entity called <code>LastChangeDate</code> and <code>LastChangeTime</code>.
To maintain these you have to add code in the <code>OnSavingRow</code> of each controller that &quot;may&quot; update this entity.</p>
<p>Also - you may have all sorts of validations that should be the same when the user inputs and when there is an automatic import process.</p>
<p>These are the exact problems that <code>OnSavingRow</code> in the <code>Entity</code> class can solve (since version 30725).
The <code>OnSavingRow</code> in the <code>Entity</code> class is called immediately after the <code>OnSavingRow</code> of the specific controller, for each entity that is updated, deleted or inserted.</p>
<p>The <code>OnSavingRow</code> event receives an event args that specify the specific activity - <code>Insert</code>, <code>Update</code> or <code>Delete</code></p>
<p>Here's an example of it's usage:</p>
<pre data-line="17,18,19,20,21" class="language-csdiff line-numbers"><code>public class Customers : Entity 
{
    #region Columns
    ...
    public readonly DateColumn LastChangeDate = new DateColumn();
    public readonly TimeColumn LastChangeTime = new TimeColumn();
    #endregion
    #region Indexes
    ...
    #endregion
    public Customers() : base("dbo.Customers", "Customers", Northwind.Shared.DataSources.Northwind1)
    {
        Cached = false;
        CustomerID.ClearExpandEvent();
        InitializeIndexes();
    }
    protected override void OnSavingRow(IEntityOnSavingRowEventArgs e)
    {
        LastChangeDate.Value = Date.Now;
        LastChangeTime.Value = Time.Now;
    } </code></pre>
<h2 id="automatically-adding-columns-to-all-controller">Automatically adding Columns to all Controller</h2>
<p>If you want to make sure that specific columns in an entity will always be added to all Controllers that use this Entity, override the <code>GetMandatoryColumns</code> method</p>
<pre data-line="22,23,24,25" class="language-csdiff line-numbers"><code>public class Customers : Entity 
{
    #region Columns
    ...
    public readonly DateColumn LastChangeDate = new DateColumn();
    public readonly TimeColumn LastChangeTime = new TimeColumn();
    #endregion
    #region Indexes
    ...
    #endregion
    public Customers() : base("dbo.Customers", "Customers", Northwind.Shared.DataSources.Northwind1)
    {
        Cached = false;
        CustomerID.ClearExpandEvent();
        InitializeIndexes();
    }
    protected override void OnSavingRow(IEntityOnSavingRowEventArgs e)
    {
        LastChangeDate.Value = Date.Now;
        LastChangeTime.Value = Time.Now;
    }
    protected override ColumnBase[] GetMandatoryColumns()
    {
        return new ColumnBase[] { LastChangeDate, LastChangeTime };
    } </code></pre>


                <br />
                        <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>

                        <a id="nextButton" class="btn btn-neutral" style="visibility:hidden;float:right">Next</a>
                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//30-Maintaining-the-Migrated-Application/40-Refactoring-Migrated-Code/15-Entity-OnSavingRow.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        <img src="assets/img/logo-big.png">
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'entity-onsavingrow.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>