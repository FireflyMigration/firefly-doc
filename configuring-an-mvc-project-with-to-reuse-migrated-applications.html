<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8" />
    <meta name="keywords" content="">

    <title>Configuring an MVC Project with to reuse Migrated Applications</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper">

        <div class="middle">

            <div class="container">

                <div class="content" role="navigation" aria-label="footer navigation">
                    <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>
                    <a id="nextButton" class="btn btn-neutral float-right" style="visibility:hidden">Next</a>
                </div>
                <div class="content"><h1 id="configuring-an-mvc-project-with-to-reuse-migrated-applications">Configuring an MVC Project with to reuse Migrated Applications</h1>
<p>In this article we'll explain how to configure an MVC project to work with a migrated project.</p>
<h1 id="add-a-new-mvc-project">Add a new MVC project</h1>
<ol>
<li><p>Choose - add new project, and select <code>ASP.NET Web Application (.NET Framework)</code></p>
</li>
<li><p>In the next wizard page, select the <code>Empty</code> template, and check the box next to <code>MVC</code>. You can also check the boxes next to <code>Web.API</code> and <code>Web Forms</code> if you want to use these technologies as well.</p>
</li>
</ol>
<blockquote>
<p>we choose the <code>Empty</code> template, because all other templates contain demo code that we don't need.</p>
</blockquote>
<h1 id="required-references">Required References</h1>
<p>Add references to the following:</p>
<ol>
<li><code>Firefly.Box.DLL</code></li>
<li><code>ENV</code></li>
<li>Your project (<code>Northwind</code>)</li>
<li>Your base project (<code>NorthwindBase</code>)</li>
</ol>
<h1 id="configuring-the-project">Configuring the project</h1>
<ol>
<li>Copy the ini file to the web application project.</li>
<li>Make the following changes to the <code>global.asax.cs</code> file</li>
</ol>
<pre data-line="8,9,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53" class="language-csdiff line-numbers"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.Web.Optimization;
using System.Web.Routing;
using ENV;
using ENV.Data.DataProvider;

namespace NorthwindMVC
{
    public class MvcApplication : System.Web.HttpApplication
    {
        protected void Application_Start()
        {
            AreaRegistration.RegisterAllAreas();
            FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);
            RouteConfig.RegisterRoutes(RouteTable.Routes);
            BundleConfig.RegisterBundles(BundleTable.Bundles);

            //additions related to the migrated code
            Common.SuppressDialogs();
            UserSettings.DoNotDisplayUI = true;

             ConnectionManager.UseConnectionPool = true;

             //sets the current directory to the web folder directory
             Environment.CurrentDirectory = HttpContext.Current.Server.MapPath("");
             
             // Call the init of the original application to load it's ini and other settings
             Northwind.Program.Init(new string[0]);
        }
         [ThreadStatic]
         static IDisposable _profilerContext;
         protected void Application_BeginRequest(object sender, EventArgs e)
         {
             // will cause any uicontroller that is called to exit.
             Firefly.Box.Context.Current.SetNonUIThread();
             // enabled profiler for every request.
             _profilerContext = ENV.Utilities.Profiler.StartContextAndSaveOnEnd(() =&gt; ENV.ProgramCollection.CollectRequestPArametersForProfiler(), () =&gt; VirtualPathUtility.MakeRelative("~", Request.Url.AbsolutePath).Replace("/", "_") + "_" + Firefly.Box.Date.Now.ToString("YYYYMMDD") + "_" + UserMethods.Instance.mTime().ToString());
         }
         protected void Application_EndRequest(object sender, EventArgs e)
         {
             // close the profiler context if exists
             if (_profilerContext != null)
             {
                 _profilerContext.Dispose();
                 _profilerContext = null;
             }
             // release all resources, including connections etc...
             Firefly.Box.Context.Current.Dispose();
         }
    }
} </code></pre>
<h1 id="important-note">Important note</h1>
<p>When calling a migrated controller from a web project please remember that the <code>ApplicationCore</code> class's <code>OnStart</code> method is called before each request, and the <code>OnEnd</code> method is called after each request.</p>
<p>We recommend that you adjust these method to run as little code as possible for performance considerations.</p>


                <br />
                        <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>

                        <a id="nextButton" class="btn btn-neutral" style="visibility:hidden;float:right">Next</a>
                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//30-Maintaining-the-Migrated-Application/95-Web-Development/Setup and Configuration/00-Configuring-an-MVC-Project-with-to-reuse-Migrated-Applications/index.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        <img src="assets/img/logo-big.png">
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'configuring-an-mvc-project-with-to-reuse-migrated-applications.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>