<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8" />
    <meta name="keywords" content="">

    <title>Adding Custom Column Filters</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper">

        <div class="middle">

            <div class="container">

                <div class="content" role="navigation" aria-label="footer navigation">
                    <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>
                    <a id="nextButton" class="btn btn-neutral float-right" style="visibility:hidden">Next</a>
                </div>
                <div class="content"><h1 id="adding-custom-column-filters">Adding Custom Column Filters</h1>
<p>When using the EnhancedGridFeatures you can add your own filter options to the grid column, and make them on or off by default.</p>
<p>Here's an example of how it works</p>
<p><img src="allow-column-filtering.gif" alt="" /></p>
<p>Here is an example of how to use it:</p>
<pre data-line="8,9" class="language-csdiff line-numbers"><code> partial class ShowCustomersView : Shared.Theme.Controls.CompatibleForm 
{
    ShowCustomers _controller;
    internal ShowCustomersView(ShowCustomers controller)
    {
        _controller = controller;
        InitializeComponent();
        gclCity.AddFilterOption("London", _controller.Customers.City.IsEqualTo("London"), true);
        gclCity.AddFilterOption("Berlin", _controller.Customers.City.IsEqualTo("Berlin"), false);
    }
} </code></pre>
<h2 id="how-to-add-it-to-older-versions-of-env">How to add it to older versions of ENV</h2>
<p>In the <code>GridColumn.cs</code> file, add the following code:</p>
<pre data-line="2,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52" class="language-csdiff line-numbers"><code>using ENV.Labs;
using Firefly.Box.Data.Advanced;
using Firefly.Box.UI;

...

public class GridColumn : Firefly.Box.UI.GridColumn
{
    public GridColumn()
    {

    }

    protected override string Translate(string term)
    {
        return base.Translate(ENV.Languages.Translate(term));
    }
    public void AddFilterOption(string name, FilterBase where, bool defaultActive = false)
    {
        AddFilterOption(name, () =&gt; where, defaultActive);
    }
    public void AddFilterOption(string name, Func&lt;FilterBase&gt; where, bool defaultActive = false)
    {
        _filterOptions.Add(new FilterOption(name, where, defaultActive));
    }
    List&lt;FilterOption&gt; _filterOptions = new List&lt;FilterOption&gt;();
    class FilterOption
    {
        private string _name;
        private Func&lt;FilterBase&gt; _where;
        private bool _defaultActive;

        public FilterOption(string name, Func&lt;FilterBase&gt; where, bool defaultActive)
        {
            _name = name;
            _where = where;
            _defaultActive = defaultActive;
        }

        internal void Apply(Action&lt;string, Func&lt;FilterBase&gt;, bool&gt; add)
        {
            add(_name, _where, _defaultActive);
        }
    }

    internal void ProvideFilterOptionsTo(Action&lt;string, Func&lt;FilterBase&gt;, bool&gt; add)
    {
        foreach (var item in _filterOptions)
        {
            item.Apply(add);
        }
    }

    public override Firefly.Box.UI.FontScheme FontScheme
    { </code></pre>
<p>In the <code>Grid.cs</code> file make the following changes to the <code>ColumnHelper</code> class:</p>
<ol>
<li>Change the <code>AddFilterOption</code>:</li>
</ol>
<pre data-line="2,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33" class="language-csdiff line-numbers"><code>-void AddFilterOption(string name, Func&lt;UIController, FilterBase&gt; createFilter)
void AddFilterOption(string name, Func&lt;UIController, FilterBase&gt; createFilter, bool defaultOn = false)
{
    var item = new ToolStripMenuItem(name);
    _cm.Items.Add(item);
    if (defaultOn)
    {
        DoOnCurrentUIController((uic) =&gt;
        {

            var f = createFilter(uic);
            if (f != null)
            {
                _applyFilter = y =&gt; y.Add(f);
                foreach (var i in _cm.Items)
                {
                    var m = i as ToolStripMenuItem;
                    if (m != null)
                        m.Checked = false;
                }
                item.Checked = true;
                _gridColumn.HeaderButton.Pinned = true;
            }
            if (df == null)
            {
                df = new DynamicFilter(z =&gt;
                {
                    _applyFilter(z);
                });
                uic.Where.Add(df);
            }
        }, _gridColumn);
    }
    item.Click +=
        delegate
        {
            ENV.Common.RunOnLogicContext(_gridColumn,
                () =&gt;
... </code></pre>
<ol start="2">
<li>In the <code>Init</code> method  of the <code>ColumnHelper</code> class add the following call</li>
</ol>
<pre data-line="19" class="language-csdiff line-numbers"><code> public void Init()
{
    if (_col != null)
        return;
    InputControlBase icb=null;
    foreach (var control in _gridColumn.Controls)
    {
        icb = control as Firefly.Box.UI.Advanced.InputControlBase;
        if (icb != null)
        {
            var col = Common.GetColumn(icb);
            if (col != null)
            {
                _col = col;

            }
        }
    }
    _gridColumn.ProvideFilterOptionsTo((name, filter, defaultOn) =&gt; AddFilterOption(name, c =&gt; filter(), defaultOn));

    if (_col == null)
        return;
		.... </code></pre>


                <br />
                        <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>

                        <a id="nextButton" class="btn btn-neutral" style="visibility:hidden;float:right">Next</a>
                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//30-Maintaining-the-Migrated-Application/70-User Interface/Adding-Custom-Column-Filters/index.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        <img src="assets/img/logo-big.png">
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'adding-custom-column-filters.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>