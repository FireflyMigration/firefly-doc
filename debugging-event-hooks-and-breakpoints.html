<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8" />
    <meta name="keywords" content="">

    <title>Debugging Event Hooks and BreakPoints</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper">

        <div class="middle">

            <div class="container">

                <div class="content" role="navigation" aria-label="footer navigation">
                    <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>
                    <a id="nextButton" class="btn btn-neutral float-right" style="visibility:hidden">Next</a>
                </div>
                <div class="content"><h1 id="debugging-event-hooks-and-breakpoints">Debugging Event Hooks and BreakPoints</h1>
<p>Breakpoints are great, and you can use them in specific controllers when you know exactly what you're looking for, but sometimes you're not sure in which controller the code executes and you would like to put a break point to cast a wider net.
For that case we've created a set of static events that you can register and add breakpoints in, to monitor general purpose stuff.</p>
<p>Normally you would register to that event for debugging purposes only and at the start of your application, so if it's a Windows Forms application you would register to any of these events in the <code>Init</code> or <code>Main</code> methods of the <code>Program</code> class.</p>
<p>Let's review the different types of events.</p>
<h2 id="entity.entitysavingrow">Entity.EntitySavingRow</h2>
<p>As of version 30725 there is a static event called 'EntitySavingRow' in 'ENV.Data.Entity'. This event will be fired whenever and there is an Update, Insert or Delete operation for an Entity.
It receives two arguments:</p>
<ol>
<li>The <code>Entity</code> for which the OnSavingRow is called.</li>
<li>The Event args, that include the Activity (Update, Insert or Delete)</li>
</ol>
<p>Here's an example of logging each insert operation to the output window</p>
<pre data-line="11,12,13,14,15,16,17" class="language-csdiff line-numbers"><code>namespace Northwind
{
    public class Program
    {
        [System.STAThread]
        public static void Main(string[] args)
        {
            try
            {
                Init(args);
                ENV.Data.Entity.EntitySavingRow += (entity, arg) =&gt;
                {
                    if (arg.Activity == Activities.Insert)
                    {
                        System.Diagnostics.Debug.WriteLine("Insert Into " + entity.EntityName);
                    }
                };

                ApplicationCore.Run();
                ... </code></pre>
<blockquote>
<p>for additional ways of debugging data changes see: <a href="additional-events-for-data-related-debugging.html">additional-events-for-data-related-debugging</a></p>
</blockquote>
<h2 id="pathdecoder.afterdecode">PathDecoder.AfterDecode</h2>
<p>As of version 30727
This event will fire whenever a path is being decoded (Logical Name). Every FileDelete or any other method that uses DecodePath will fire it. It's a great way to find where a specific file is being accessed
It receives two parameters:</p>
<ol>
<li>source - the original value before decoding</li>
<li>result - the values after it was decoded</li>
</ol>
<pre data-line="2,3,4,5,6,7,8" class="language-csdiff line-numbers"><code>Init(args);
ENV.PathDecoder.AfterDecode += (source, result) =&gt;
{
     if (result.ToLower().Contains(@"c:\temp"))
     {
         System.Diagnostics.Debugger.Break();
     }
};
ApplicationCore.Run();
ENV.UserSettings.FinalizeINI(); </code></pre>
<h2 id="profiler.onstartcontext">Profiler.OnStartContext</h2>
<p>As of version 30725
This event is fired just before anything is written to the profiler. This can be useful if you see something in the profiler and you wish to break on it, for example a specific sql statement etc...
Remember that the profiler has to be switched on for this breakpoint to work.</p>
<p>For example, I want to break whenever a specific SQL statement is executed:</p>
<pre data-line="4,5,6,7,8,9,10,11,12,13,14" class="language-csdiff line-numbers"><code>Init(args);
ENV.Utilities.Profiler.OnStartContext += e =&gt;
{
     if (e.Name.Contains(@"Select ProductID, UnitPrice 
From dbo.Products 
Where ProductID = @0

Parameters:
@0(Int32) = 11 (B)
"))
     {
         System.Diagnostics.Debugger.Break();
     }
};

ApplicationCore.Run();
ENV.UserSettings.FinalizeINI(); </code></pre>
<h2 id="controllerbase.onprocessingcommand">ControllerBase.OnProcessingCommand</h2>
<p>This event is fired whenever a command is about to be processed.
It receives two parameters:</p>
<ol>
<li>controller - the controller which is about to process the command</li>
<li>command - the actual command.</li>
</ol>
<p>This is a very useful event that helps track down who is handling an event that was raised. You can use this to find events that were raised and were not handled where you've thought they should be handled. Like handlers with <code>CurrentTaskOnly</code> pre condition - or multiple <code>Exit</code> events.</p>
<pre data-line="4,5,6,7" class="language-csdiff line-numbers"><code>try
{
    Init(args);
    ENV.ControllerBase.OnProcessingCommand += (controller, command) =&gt;
    {

    };

    ApplicationCore.Run();
    ENV.UserSettings.FinalizeINI();
} </code></pre>
<h2 id="controllerbase.onraise">ControllerBase.OnRaise</h2>
<p>This event is fired whenever an event is raised, either from a button or from a Raise command. Helps track down these Raise <code>Exit</code> that are all over the code.
Receives one parameter - the command that is being raised.</p>
<h2 id="handlercollectionwrapper.beforehandler">HandlerCollectionWrapper.BeforeHandler</h2>
<p>This event is fired just before a handler is executed. You can break in it and once you hit the Breakpoint, just Click F10 to go to the Handler's code.
It receives one parameter, the handler that is about to be invoked.</p>
<h2 id="controllerbase-beforeexecute-and-afterexecute">ControllerBase BeforeExecute and AfterExecute</h2>
<p>These events are fired before and after the execution of a controller.
It receives one parameter - the controller that is about to be executed. You can create all sorts of creative if statements around that controller.
Here's an example of getting the root <code>BusinessProcess</code> and playing with it:</p>
<pre data-line="2,3,4,5,6,7,8,9,10,11,12" class="language-csdiff line-numbers"><code>Init(args);
ENV.ControllerBase.BeforeExecute += (controller) =&gt;
{
     var bp = ENV.ControllerBase.GetTask(controller) as Firefly.Box.BusinessProcess;
     if (bp != null)
     {
         if (bp.Relations.Count &gt; 0)
         {
             System.Diagnostics.Debug.WriteLine("The controller " + controller + " was called and has relations");
         }
     }
};

ApplicationCore.Run();
ENV.UserSettings.FinalizeINI(); </code></pre>
<h2 id="beforewrite-and-beforeread">BeforeWrite and BeforeRead</h2>
<p>These events are fired before a section is about to be written (or read) from an IO.
They exist at the following classes:</p>
<ol>
<li>ReportSection.BeforeWrite - before writing a report form</li>
<li>TextSection.BeforeWrite - before writing a text section</li>
<li>TextSection.BeforeRead - before reading a text section</li>
<li>TextTemplate.BeforeWrite - before writing a text template (AKA merge form)</li>
</ol>
<ul>
<li><a href="additional-events-for-data-related-debugging1.html">Additional Events for Data Related Debugging1</a></li>
</ul>



                        <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>

                        <a id="nextButton" class="btn btn-neutral" style="visibility:hidden;float:right">Next</a>
                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//30-Maintaining-the-Migrated-Application/20-Debugging-the-Migrated-Application/15-Debugging-Event-Hooks-and-BreakPoints/index.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        <img src="assets/img/logo-big.png">
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'debugging-event-hooks-and-breakpoints.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>