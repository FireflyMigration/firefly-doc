<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8" />
    <meta name="keywords" content="">

    <title>Exercise - Updating Data Programmatically result</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper">

        <div class="middle">

            <div class="container">

                <div class="content" role="navigation" aria-label="footer navigation">
                    <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>
                    <a id="nextButton" class="btn btn-neutral float-right" style="visibility:hidden">Next</a>
                </div>
                <div class="content"><h1 id="exercise-updating-data-programmatically-result">Exercise - Updating Data Programmatically result</h1>
<p>The <strong>ShowProducts</strong> class should look like :</p>
<pre data-line="69,70,71,72" class="language-csdiff line-numbers"><code>using System;
using System.Collections.Generic;
using System.Text;
using System.Drawing;
using Firefly.Box;
using ENV;
using ENV.Data;

namespace Northwind.Exercises
{
    public class ShowProducts : UIControllerBase
    {

        public readonly Models.Products Products = new Models.Products();
        public readonly Models.Categories Categories = new Models.Categories();

        public ShowProducts()
        {
            From = Products;
            Relations.Add(Categories, RelationType.Find,
                Categories.CategoryID.IsEqualTo(Products.CategoryID));

            Where.Add(Products.CategoryID.IsEqualTo(2).Or(Products.CategoryID.IsEqualTo(4).Or(Products.CategoryID.IsEqualTo(6))));
            Where.Add(Products.UnitPrice.IsGreaterThan(25));

            OrderBy = Products.SortByProductName;
        }

        public void Run()
        {
            Execute();
        }

        protected override void OnLoad()
        {
            View = () =&gt; new Views.ShowProductsView(this);
        }

        protected override void OnSavingRow()
        {
            InputValidation();
        }
        #region expressions
        private void InputValidation()
        {
            if (Products.ProductName == "")
                Message.ShowError("Product name is empty!");
            if (Products.UnitsInStock == 0 || Products.UnitsOnOrder == 0)
                System.Windows.Forms.MessageBox.Show("Units is zero");
            if (Products.UnitsInStock &lt; 10)
                Message.ShowWarning("Not enough units");
            if (Products.UnitsOnOrder &gt;= 50 &amp;&amp; Products.UnitsOnOrder &lt;= 100)
                Message.ShowError("Units on order are between 50 and 100");
            if (u.Len(u.Trim(Products.ProductName)) &lt; 3)
                Message.ShowError("Please enter a valid product name");
            if (u.InStr(Products.ProductName, "%") &gt;= 1 || u.InStr(Products.ProductName, "@") &gt;= 1)
                Message.ShowError("% and @ are invalid characters in product name");
            if (u.Left(Products.ProductName, 1) == "T")
                Message.ShowWarningInStatusBar("Product name can't start with a T");
            if (ValidateCaregoryID())
                Message.ShowError("Please enter a valid category");
        }

        private bool ValidateCaregoryID()
        {
            return !Relations[Categories].RowFound;
        }

        public Number TotalUnits()
        {
            return Products.UnitsInStock + Products.UnitsOnOrder;
        }
        #endregion
    }
} </code></pre>
<p>The <strong>ShowProducts</strong> code behind of the form should look like :</p>
<pre data-line="27" class="language-csdiff line-numbers"><code>using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using Firefly.Box;
using Firefly.Box.UI.Advanced;
using ENV;
using ENV.Data;

namespace Northwind.Exercises.Views
{
    partial class ShowProductsView : Shared.Theme.Controls.Form
    {
        ShowProducts _controller;
        public ShowProductsView(ShowProducts controller)
        {
            _controller = controller;
            InitializeComponent();
        }

        private void button1_Click(object sender, ButtonClickEventArgs e)
        {
-           MessageBox.Show("Total Units : will be displayed soon");
            MessageBox.Show("Total Units : " + _controller.TotalUnits());
        }

        private void txtUnitsOnOrder_BindBackColor(object sender, ColorBindingEventArgs e)
        {
            if (_controller.Products.UnitsOnOrder == 0)
                e.Value = Color.Red;
            if (_controller.Products.UnitsOnOrder &gt; 0 &amp;&amp; _controller.Products.UnitsOnOrder &lt;= 10)
                e.Value = Color.Yellow;
            if (_controller.Products.UnitsOnOrder &gt; 10)
                e.Value = Color.Green;
        }
    }
} </code></pre>
<p>The <strong>ShowEmployeeCars</strong> class should look like :</p>
<pre data-line="15,19,31,32,33,34" class="language-csdiff line-numbers"><code>using System;
using System.Collections.Generic;
using System.Text;
using System.Drawing;
using Firefly.Box;
using ENV;
using ENV.Data;

namespace Northwind.Exercises
{
    public class ShowEmployeeCars : UIControllerBase
    {

        public readonly Northwind.Models.EmployeeCars EmployeeCars = new Northwind.Models.EmployeeCars();
        public readonly NumberColumn AverageKM = new NumberColumn();
        public ShowEmployeeCars()
        {
            From = EmployeeCars;
            AverageKM.BindValue(GetAverageKM);
        }

        public void Run()
        {
            Execute();
        }

        protected override void OnLoad()
        {
            View = () =&gt; new Views.ShowEmployeeCarsView(this);
        }
        public Number GetAverageKM()
        {
            return EmployeeCars.CarKM / (Date.Now.Year - EmployeeCars.CarYear);
        }
    }
} </code></pre>
<p>After <strong>item 11</strong> in the Exercise the <strong>ShowEmployeeCars</strong> class should look like :</p>
<pre data-line="35" class="language-csdiff line-numbers"><code>using System;
using System.Collections.Generic;
using System.Text;
using System.Drawing;
using Firefly.Box;
using ENV;
using ENV.Data;

namespace Northwind.Exercises
{
    public class ShowEmployeeCars : UIControllerBase
    {

        public readonly Northwind.Models.EmployeeCars EmployeeCars = new Northwind.Models.EmployeeCars();
        public readonly NumberColumn AverageKM = new NumberColumn();
        public ShowEmployeeCars()
        {
            From = EmployeeCars;
            AverageKM.BindValue(GetAverageKM);
        }

        public void Run()
        {
            Execute();
        }

        protected override void OnLoad()
        {
            View = () =&gt; new Views.ShowEmployeeCarsView(this);
        }
-       public Number GetAverageKM()
-       {
-           return EmployeeCars.CarKM / (Date.Now.Year - EmployeeCars.CarYear);
-       }
        public Number GetAverageKM()=&gt;EmployeeCars.CarKM / (Date.Now.Year - EmployeeCars.CarYear);
    }
} </code></pre>
<p>After <strong>item 13</strong> in the Exercise the <strong>ShowEmployeeCars</strong> class should look like :</p>
<pre data-line="20" class="language-csdiff line-numbers"><code>using System;
using System.Collections.Generic;
using System.Text;
using System.Drawing;
using Firefly.Box;
using ENV;
using ENV.Data;

namespace Northwind.Exercises
{
    public class ShowEmployeeCars : UIControllerBase
    {

        public readonly Northwind.Models.EmployeeCars EmployeeCars = new Northwind.Models.EmployeeCars();
        public readonly NumberColumn AverageKM = new NumberColumn();
        public ShowEmployeeCars()
        {
            From = EmployeeCars;
-           AverageKM.BindValue(GetAverageKM);
            AverageKM.BindValue(()=&gt;EmployeeCars.CarKM / (Date.Now.Year - EmployeeCars.CarYear));
        }

        public void Run()
        {
            Execute();
        }

        protected override void OnLoad()
        {
            View = () =&gt; new Views.ShowEmployeeCarsView(this);
        }
-       public Number GetAverageKM()=&gt;EmployeeCars.CarKM / (Date.Now.Year - EmployeeCars.CarYear);
    }
} </code></pre>
<p>The <strong>ShowOrders</strong> class should look like :</p>
<pre data-line="19" class="language-csdiff line-numbers"><code>using System;
using System.Collections.Generic;
using System.Text;
using System.Drawing;
using Firefly.Box;
using ENV;
using ENV.Data;

namespace Northwind.Exercises
{
    public class ShowOrders : UIControllerBase
    {
        public readonly Models.Orders Orders = new Models.Orders();
        public readonly DateColumn EstimatedArrivalDate = new DateColumn();
        public ShowOrders()
        {
            From = Orders;
            Where.Add(Orders.OrderDate.IsBetween(new Date(1996, 1, 1), new Date(1997, 6, 30)));
            EstimatedArrivalDate.BindValue(() =&gt; Orders.OrderDate.AddDays(30));
        }

        public void Run()
        {
            Execute();
        }
        
        protected override void OnLoad()
        {
            View = () =&gt; new Views.ShowOrdersView(this);
        }
        protected override void OnEnterRow()
        {
            EstimatedArrivalDate.Value = Orders.OrderDate.AddDays(30);
        }
    }
} </code></pre>
<p>The run time version should look like :
<img src="2017-04-18_15h56_33.png" alt="2017-04-18_15h56_33" /></p>



                        <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>

                        <a id="nextButton" class="btn btn-neutral" style="visibility:hidden;float:right">Next</a>
                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//01-Development/01-Developer-Guide/09-Local-Columns-and-BindValue/13-Exercise-Updating-Data-Programmatically/01-Exercise-Updating-Data-Programmatically-results.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        <img src="assets/img/logo-big.png">
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'exercise-updating-data-programmatically-results.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>