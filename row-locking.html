<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8" />
    <meta name="keywords" content="lockcurrentrow ,rowlocking, lockingstrategies, lockingstrategy, onUserEdit, OnMoodify,LockCurrentRowIfItWasChanged">

    <title>Row Locking</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper" id="root">
        <div class="backdrop"></div>
        <div class="top-bar" role="navigation" aria-label="footer navigation">
            <div style="display:flex;">
                <div>
                    <a id="menu" class="btn btn-neutral">&#9776; </a>
                </div>
                <img src="assets/img/logo-big.png">
            </div>
            <div>
                <a id="previousButton" class="btn btn-neutral" style="visibility:hidden">Previous</a>
                <a id="nextButton" class="btn btn-neutral" style="visibility:hidden">Next</a>
            </div>
        </div>
        <div class="middle">

            <div class="container">

                <div class="content"><h1 id="row-locking">Row Locking</h1>
<p>Every Controller has a property called <code>RowLocking</code> which controls when locking shall be applied for this controller.</p>
<p>The different locking strategies are detailed in the documentation of <a href="/reference/html/T_Firefly_Box_LockingStrategy.htm">LockingStragey</a>.
To see the comparison of the different strategies to magic see <a href="locking-strategy.html">Locking Strategy in magic</a></p>
<h3 id="when-will-the-locking-start">When Will the locking start?</h3>
<p>The start of the locking is controlled by the <code>RowLocking</code> property - and is based on the strategy.</p>
<ul>
<li>None - the lock will never start</li>
<li>OnRowLoading - the lock wills start once the row is loaded - just before the <code>EnterRow</code> event.</li>
<li>OnRowSaving - the lock with start before the row is saved to the database - after the <code>SavingRow</code> event.</li>
<li>OnUserEdit - the lock will start when the user edits a value on the screen</li>
</ul>
<h4 id="lockcurrentrow-method">LockCurrentRow method</h4>
<p>When using the <code>OnUserEdit</code> LockingStrategy - the lock can be started by calling the <code>LockCurrentRow()</code> method.
In the migrated code, you'll see a call to the <code>LockCurrentRow()</code> method whenever magic would have started a lock.</p>
<p>When the <code>LockCurrentRow()</code> method is called for the first time since entering the row, it'll lock the row. Any subsequent calls to the <code>LockCurrentRow()</code> method will be ignored - since the row is already locked.</p>
<p>You may see many calls in the migrated code to <code>LockCurrentRow()</code>  in controllers that were migrated and were using the <code>OnModify</code> magic locking strategy, that is because magic was starting locks on updates and call programs based on in many different (And sometimes mysterious) scenarios.
We made sure the make the call to <code>LockCurrentRow</code> apparent and to highlight this behavior.</p>
<p>If you see many subsequent calls to <code>LockCurrentRow()</code>, don't worry about it - as only the first one locks.</p>
<h4 id="lockcurrentrowifitwaschanged-method">LockCurrentRowIfItWasChanged method</h4>
<p>It's a variation of the <code>LockCurrentRow</code> method that will only lock if the row was already changed, based on the <code>RowChanged</code> property.
It is used in the migrated code whenever magic was locking but not always - just when the row was changed.</p>
<h3 id="which-entities-will-be-locked">Which entities will be locked?</h3>
<p>When the lock starts, all entities for which the <code>AllowRowLocking</code> property is set, will be locked.
<img src="allow-row-locking.png" alt="Allow Row Locking" /></p>
<blockquote>
<p>Note that if the same entity was already defined in a calling controller with <code>AllowRowLocking = true</code>, than that same entity in this controller will also be treated as if <code>AllowRowLocking</code> is set to true.
that is controlled by the <code>ShouldDetermineNameAcordingToCallStack</code> property of the entity. Set this property to false to disable that behavior.</p>
</blockquote>
<h3 id="when-will-the-lock-be-released">When will the lock be released?</h3>
<p>Any row that was updated will remain locked until the end of the transaction.</p>
<p>Rows that were not updated, will have their lock released according the the specific database that is in use.</p>
<ul>
<li>For Oracle, SQL Server ODBC, and oledb the lock will only be released after the transaction is committed.</li>
</ul>
<blockquote>
<p>we are currently working on a solution where in SQL server the lock could be released after it was left - let us know if you're interested.</p>
</blockquote>
<ul>
<li>For Btrieve, Pervasive, DB2 Iseries, DB2, Easycom - the lock will be released after you leave the row (after the <code>SavingRow</code> event)</li>
</ul>
<h3 id="locking-and-transactions">Locking and Transactions</h3>
<ul>
<li>Btrieve (Pervasive) and eascom ISAM - allows for locking without a transaction.</li>
<li>In SQL Server, Oracle, DB2, ODBC etc... you can only lock if a transaction was already opened.</li>
</ul>
<blockquote>
<p>we are current working on a solution where in SQL server and DB2 you'll be able to lock without a transaction.</p>
</blockquote>



                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//20-Getting-Familiar-with-Migrated-Code/50-DataAccess/50-Transactions-and-locking/20-Row-Locking.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'row-locking.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>