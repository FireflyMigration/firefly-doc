<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8" />
    <meta name="keywords" content="">

    <title>Adding EasySql to an Existing Project</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper" id="root">
        <div class="backdrop"></div>
        <div class="top-bar" role="navigation" aria-label="footer navigation">
            <div style="display:flex;">
                <div>
                    <a id="menu" class="btn btn-neutral">&#9776; </a>
                </div>
                <img src="assets/img/logo-big.png">
            </div>
            <div>
                <a id="previousButton" class="btn btn-neutral" style="visibility:hidden">Previous</a>
                <a id="nextButton" class="btn btn-neutral" style="visibility:hidden">Next</a>
            </div>
        </div>
        <div class="middle">

            <div class="container">

                <div class="content"><h1 id="adding-easysql-to-an-existing-project">Adding EasySql to an Existing Project</h1>
<p>Simply download the <a href="https://raw.githubusercontent.com/FireflyMigration/EasySql/master/ENV/Utilities/EasySql.cs">EasySql</a> file and add it to the <code>ENV</code> project under the <code>Utilities</code> folder.</p>
<h2 id="for-env-versions-17000">For ENV versions &gt;17000</h2>
<p>You'll also need to make the following changes to older versions of the <code>DynamicSQLEntity</code> class - with regards to it's constructor</p>
<pre data-line="7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,28" class="language-csdiff line-numbers"><code>...
public IEntityDataProvider DataProvider
{
    get { return _originalProvider; }
}
-ISQLBuilder _sqlBuilder;
ISQLBuilder _sqlBuilder
{
     get
     {
         if (__theBuilder == null)
             __theBuilder = _sqlBuilderFactory();
         return __theBuilder;
     }
}
Func&lt;ISQLBuilder&gt; _sqlBuilderFactory;
ISQLBuilder __theBuilder;
	public DynamicSQLEntity(DynamicSQLSupportingDataProvider dataProvider, Func&lt;string&gt; sql)
     : this(dataProvider, "dynamicSql")
{
     _sqlBuilderFactory = () =&gt; DynamicSQLSupportingDataProvider.ExecutionStrategy.GetSQLBuilder(sql());
}
public DynamicSQLEntity(DynamicSQLSupportingDataProvider dataProvider, string sql)
    : base(sql, sql, dataProvider.ProvideDynamicSqlEntityDataProvider())
{
    _originalProvider = dataProvider;
-   _sqlBuilder = DynamicSQLSupportingDataProvider.ExecutionStrategy.GetSQLBuilder(sql) ;
    _sqlBuilderFactory = () =&gt; DynamicSQLSupportingDataProvider.ExecutionStrategy.GetSQLBuilder(sql);
    TrimTextColumnParameterValues = DefaultTrimTextColumnParameterValues;
    TrimExpressionParameterValues = TrimExpressionValuesDefault;
    RemoveTextAfterSemicolon = RemoveTextAfterSemicolonDefault;
}
public static bool OemTextParameters { get; set; }
... </code></pre>
<h2 id="for-env-version-17000">For ENV version &lt;17000</h2>
<p>There are a few relevant changes.
First, in the <code>EasySql</code> class there are several lines that will not build - but there should be a comment next to it with the correct line for the older ENV version.</p>
<p>In the <code>DynamicSQLEntity</code> class do the following changes:</p>
<pre data-line="5,6,8,9,10,16,23" class="language-csdiff line-numbers"><code>public IEntityDataProvider DataProvider
{
    get { return _originalProvider; }
}
Func&lt;string&gt; _buildSql;
public DynamicSQLEntity(DynamicSQLSupportingDataProvider dataProvider, Func&lt;string&gt; sql)
 : this(dataProvider, "dynamicSql")
{
     _buildSql= sql;
}
public DynamicSQLEntity(DynamicSQLSupportingDataProvider dataProvider, string sql)
    : base(sql, sql, dataProvider.ProvideDynamicSqlEntityDataProvider())
{
    _originalProvider = dataProvider;
-   _sql = sql;
    _buildSql = ()=&gt;sql;
}

.... and later down the same file
 internal string GetCompletedSQL(Func&lt;IDbDataParameter&gt; createDbParameter)
{
    string prevSql = _sql;
    _sql = _buildSql();
    try
    {
        _paramNumber = 0;
        foreach (var action in _prepareSql)
        {
            action(createDbParameter);
        }
        return _sql;
    }
    finally
    {
        _sql = prevSql;
    }
} </code></pre>
<h2 id="if-you-are-having-trouble-with-env-let-us-know">If you are having trouble with ENV, let us know</h2>
<p>If you have an even older version of dynamic sql entity and would require help, let us know - we'll be happy to help.</p>



                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//30-Maintaining-the-Migrated-Application/63-EasySql-Writing-Better-Sql/02-Adding-EasySql-to-an-Existing-Project.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'adding-easysql-to-an-existing-project.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>