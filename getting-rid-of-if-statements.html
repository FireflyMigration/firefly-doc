<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8" />
    <meta name="keywords" content="strategy pattern">

    <title>Getting rid of if statements</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper" id="root">
        <div class="backdrop"></div>
        <div class="top-bar" role="navigation" aria-label="footer navigation">
            <div style="display:flex;">
                <div>
                    <a id="menu" class="btn btn-neutral">&#9776; </a>
                </div>
                <img src="assets/img/logo-big.png">
            </div>
            <div>
                <a id="previousButton" class="btn btn-neutral" style="visibility:hidden">Previous</a>
                <a id="nextButton" class="btn btn-neutral" style="visibility:hidden">Next</a>
            </div>
        </div>
        <div class="middle">

            <div class="container">

                <div class="content"><h1 id="getting-rid-of-if-statements">Getting rid of if statements</h1>
<p>In our application we needed to implement a different discount algorithm for each country.</p>
<ul>
<li>By default - the discount was in it's $ amount.</li>
<li>For orders that are shipped to France it had to be by % of line.</li>
<li>For orders that are shipped to Germany there is no Discount.</li>
</ul>
<p>Previously this was implemented by several complicated expressions with lot's of rules.</p>
<p>Visible Expression:</p>
<pre data-line="" class="language-csdiff line-numbers"><code>internal Bool Exp_5() =&gt; _parent.Orders1.ShipCountry != "Germany"; </code></pre>
<p>Format (Picture) Expression:</p>
<pre data-line="" class="language-csdiff line-numbers"><code>internal Text Exp_4() =&gt; u.If(_parent.Orders1.ShipCountry == "France", "3%", "5.2CZ +$;"); </code></pre>
<p>Total Expression:</p>
<pre data-line="" class="language-csdiff line-numbers"><code>internal Number Exp_3() =&gt; Order_Details.UnitPrice * Order_Details.Quantity - u.If(_parent.Orders1.ShipCountry == "France", (Order_Details.UnitPrice * Order_Details.Quantity * Order_Details.Discount / 100), u.If(_parent.Orders1.ShipCountry == "Germany", 0, Order_Details.Discount)); </code></pre>
<h1 id="after-the-refactoring">After the refactoring</h1>
<p>We refactored this into a strategy object:</p>
<pre data-line="" class="language-csdiff line-numbers"><code>namespace Northwind.Orders
{
    public class DefaultDiscountStrategy
    {
        public virtual bool ShouldShowDiscountColumn()
        {
            return true;
        }
        public virtual Text DiscountColumnFormat()
        {
            return "5.2CZ +$;";
        }
        public virtual Number GetDiscount(Models.Order_Details Order_Details)
        {
            return Order_Details.Discount;
        }
    }
    public class PrecentDiscountStrategy : DefaultDiscountStrategy
    {
        public override Text DiscountColumnFormat()
        {
            return "3%";
        }
        public override Number GetDiscount(Order_Details Order_Details)
        {
            return (Order_Details.UnitPrice * Order_Details.Quantity * Order_Details.Discount / 100);
        }
    }
    public class NoDiscountStrategy : DefaultDiscountStrategy
    {
        public override bool ShouldShowDiscountColumn()
        {
            return false;
        }
        public override Number GetDiscount(Order_Details Order_Details)
        {
            return 0;
        }
    }
} </code></pre>
<p>We implemented a GetStrategy method:</p>
<pre data-line="1,2,3,4,5,6,7,8" class="language-csdiff line-numbers"><code>DefaultDiscountStrategy GetDiscountStrategy()
{
     if (_parent.Orders1.ShipCountry == "France")
         return new PrecentDiscountStrategy();
     else if (_parent.Orders1.ShipCountry == "Germany")
         return new NoDiscountStrategy();
     return new DefaultDiscountStrategy();
} </code></pre>
<p>And replaced the expressions:</p>
<p>Visible Expression:</p>
<pre data-line="2" class="language-csdiff line-numbers"><code>-internal Bool Exp_5() =&gt; _parent.Orders1.ShipCountry != "Germany";
internal Bool Exp_5() =&gt; GetDiscountStrategy().ShouldShowDiscountColumn(); </code></pre>
<p>Format (Picture) Expression:</p>
<pre data-line="2" class="language-csdiff line-numbers"><code>-internal Text Exp_4() =&gt; u.If(_parent.Orders1.ShipCountry == "France", "3%", "5.2CZ +$;");
internal Text Exp_4() =&gt; GetDiscountStrategy().DiscountColumnFormat(); </code></pre>
<p>Total Expression:</p>
<pre data-line="2" class="language-csdiff line-numbers"><code>-internal Number Exp_3() =&gt; Order_Details.UnitPrice * Order_Details.Quantity - u.If(_parent.Orders1.ShipCountry == "France", (Order_Details.UnitPrice * Order_Details.Quantity * Order_Details.Discount / 100), u.If(_parent.Orders1.ShipCountry == "Germany", 0, Order_Details.Discount));
internal Number Exp_3() =&gt; Order_Details.Quantity * Order_Details.UnitPrice - GetDiscountStrategy().GetDiscount(Order_Details); </code></pre>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UoGsJ19yUcw" frameborder="0" allowfullscreen></iframe>



                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//30-Maintaining-the-Migrated-Application/40-Refactoring-Migrated-Code/40-Getting-rid-of-if-statements/index.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'getting-rid-of-if-statements.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>