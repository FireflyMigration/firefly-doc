<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8" />
    <meta name="keywords" content="">

    <title>Database Connections basic terms and concepts</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>

<body class="markdown-body" role="document">
    <div class="wrapper">

        <div class="middle">

            <div class="container">

                <div class="content" role="navigation" aria-label="footer navigation">
                    <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>
                    <a id="nextButton" class="btn btn-neutral float-right" style="visibility:hidden">Next</a>
                </div>
                <div class="content"><h1 id="database-connections-basic-terms-and-concepts">Database Connections basic terms and concepts</h1>
<p>In this article, and the next one, I am going to take you on a journey from the old and familiar to the new and exciting. By the end of this article, we are going to understand how to setup database connections and use it in our code.</p>
<h2 id="database-definitions-in-the-ini-as-were-defined-before-the-migration">Database definitions in the ini, as were defined before the migration</h2>
<p>First, we are going to start with the INI file, specifically in the [MAGIC_DATABASE] section:</p>
<pre><code>[MAGIC_DATABASES]
Default Database = 1, , , , , , , , MagicRecordLock, ChangeFileInToolkit, +
CheckDefinition, CheckKey, FileLocks, , , , NoCheckExist, , ,
Btrieve = 22, Memory, , , , %ENVOYPATHS%, , , NoMagicRecordLock, ChangeFile+
InToolkit, CheckDefinition, CheckKey, NoFileLocks, , , NoCheckExist, +
NoCheckExist, 0, NoXATrans, NoXATrans, NoAS400SrvrSort,
Memory = 22, , , , , , , , NoMagicRecordLock, ChangeFileInToolkit, +
NoCheckDefinition, NoCheckKey, NoFileLocks, , , , NoCheckExist, , ,
Northwind = 21, Northwind, , , (local)\SQLExpress, , , , NoMagicRecordLock,+
 DontChangeFileInToolkit, CheckDefinition, NoCheckKey, NoFileLocks, , , , +
CheckExist, 0, , NoXATrans, NoAS400SrvrSort,
</code></pre>
<p>If we centralize our attention to the Northwind entry we can notice the following :
<img src="magic_db_ini.png" alt="" /></p>
<p>21 = SQL database (as specified in the DBMS section of the INI)<br />
Northwind = name of the database<br />
(local)\SQLExpress = name of the database server and so on.</p>
<h2 id="new-database-connection">New Database Connection</h2>
<p>When creating a new database connection, you can still use that ini setting, but I find it combersome.</p>
<p>Instead you can add a connection from code, here's an example:</p>
<pre data-line="" class="language-csdiff line-numbers"><code>using ENV.Data.DataProvider;
...
public class Program
{
   public static void Init(string[] args)
   {
        ...
        ConnectionManager.Shared.AddMicrosoftSQLDatabase("Northwind", "northwind", @"(local)\sqlexpress");
   }
} </code></pre>
<p>The <code>AddMicrosoftSqlDatabase</code> adds a database definition to the code and receives the following paramters:</p>
<ol>
<li>Northwind - the name of the database that you'll use later in the <code>DataSources</code> class.</li>
<li>The catalog (database) name on the sql server.</li>
<li>The name of the server.</li>
<li>optional user name.</li>
<li>optional password.</li>
</ol>
<p>There is a also a similar method called <code>AddOracleDatabase</code> for oracle, and <code>AddDatabase</code> for all other databases.</p>
<h1 id="using-these-definitions-in-the-datasources-class">Using these definitions in the DataSources class</h1>
<p>The next step is to read the INI file – the Firefly platform is using the ENV.DATA.DataProvider.ConnectionManager.cs class to do so.<br />
The “ConnectionManager” is responsible for opening and closing the connection with the database.</p>
<p>Now we can use this information in the Models.DataSources.cs file :</p>
<pre data-line="" class="language-csdiff line-numbers"><code>using ENV.Data.DataProvider;
namespace Northwind.Models
{
    public class DataSources
    {
        public static DynamicSQLSupportingDataProvider Northwind1 
        {
            get
            {
                return ConnectionManager.GetSQLDataProvider("Northwind");
            }
        }
    }
} </code></pre>
<p><img src="DynamicSQLSupporingDataProvider_explain.png" alt="" /></p>
<p>We can see that the return value is “DynamicSQLSupportingDataProvider”, which means that this is a connection to an SQL database, rather than Memory, Btrieve, etc.</p>
<p>The property “getter” (get) asks the “ConnectionManager” class for a SQLDataProvider by the name of the entry in the INI file “Northwind”.</p>
<p>The next step is to use this as part of setting an entity in the application.
We need to setup the base connection of the entity :</p>
<p><img src="DynamicSQLSupporingDataProvider_explain_bis.png" alt="" /></p>


                <br />
                        <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a>

                        <a id="nextButton" class="btn btn-neutral" style="visibility:hidden;float:right">Next</a>
                    <hr />Help us improve,
                    <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//20-Getting-Familiar-with-Migrated-Code/50-DataAccess/10-Database-Connections-basic-terms-and-concepts/index.md" target="_blank">Edit this page on GitHub</a>
                    <br /> or email us at
                    <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a>
                </div>

                <!-- .content -->




            </div>
            <!-- .container-->

            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">
                        <img src="assets/img/logo-big.png">
                    </a>
                </div>
                <div id="menuTree" </div>
            </aside>
            <!-- .left-sidebar -->

            <aside class="right-sidebar"></aside>
            <!-- .right-sidebar -->

            </div>
            <!-- .middle-->



        </div>


        <script src="assets/js/mermaid.js"></script>
        <script src="assets/js/prism-start.js"></script>
        <script src="assets/js/prism-clike.js"></script>
        <script src="assets/js/prism-markup.js"></script>
        <script src="assets/js/prism-css.js"></script>
        <script src="assets/js/prism-javascript.js"></script>

        <script src="assets/js/prism-diff.js"></script>
        <script src="assets/js/prism-csdiff.js"></script>
        <script src="assets/js/prism-function.js"></script>

        <script src="assets/js/jquery-3.1.1.js"></script>


        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-4806432-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script src="assets/js/tree.js"></script>
        <script language="javascript">
            buildTree('menuTree', 'database-connections-basic-terms-and-concepts.html', 'previousButton', 'nextButton');
        </script>
</body>

</html>